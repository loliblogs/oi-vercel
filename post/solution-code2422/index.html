<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><title>[FJOI2007] 轮状病毒 | loli&#39;s oi blog</title><meta name="author" content="lolifamily"><meta name="keywords" content=""><meta name="description" content="由于内容过长、公式较多，暂时将内容隐藏，请公式恐惧症们做好心理准备。ProblemDescription轮状病毒有很多变种，所有轮状病毒的变种都是从一个轮状基产生的。一个 $N$ 轮状基由圆环上 $N$ 个不同的基原子和圆心处一个核原子构成的，$2$ 个原子之间的边表示这 $2$ 个原子之间的信息通道。如下图所示$N$ 轮状病毒的产生规律是在一个 $N$ 轮状基中删去若干条边，使得各原子之间有唯一的信息通道，例如共有 $16$ 个不同的 $3$ 轮状病毒，如下图所示：现给定 $N (N\le 1"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><link rel="alternate" href="/oi/atom.xml" title="loli&#39;s oi blog" type="application/atom+xml"><link rel="icon" href="/oi/../images/favicon.ico"><style>@font-face{font-family:icomoon;src:url(/oi/fonts/icomoon.eot?q628ml);src:url(/oi/fonts/icomoon.eot?q628ml#iefix) format('embedded-opentype'),url(/oi/fonts/icomoon.ttf?q628ml) format('truetype'),url(/oi/fonts/icomoon.woff?q628ml) format('woff'),url(/oi/fonts/icomoon.svg?q628ml#icomoon) format('svg');font-weight:400;font-style:normal}</style><link rel="stylesheet" href="/oi/css/style.css"><!--[if lt IE 9]><style type="text/css">.nav-inner {top:0;}.author-meta {position:static;top:0;}.search-form {height:36px;}</style><script type="text/javascript" src="https://unpkg.com/html5shiv@3.7.3/dist/html5shiv.min.js"></script><![endif]--><meta name="generator" content="Hexo 6.3.0"></head><body><main class="app"><header id="header" class="header clearfix"><div id="nav" class="nav"><div class="nav-mobile"><button id="open-panel" class="open-panel nav-mobile-item"><i class="icon-documents"></i></button><h1 class="nav-mobile-title nav-mobile-item">loli&#39;s oi blog</h1><button id="open-menus" class="open-panel nav-mobile-item"><i class="icon-library"></i></button></div><nav id="nav-inner" class="nav-inner"><a class="nav-item" href="/oi/../"><span class="nav-text">首页</span> </a><a class="nav-item" href="/oi/."><span class="nav-text">oi</span> </a><a class="nav-item" href="/oi/../project/"><span class="nav-text">project</span> </a><a class="nav-item" href="/oi/categories/%E9%A2%98%E8%A7%A3/"><span class="nav-text">题解</span> </a><a class="nav-item" href="/oi/categories/%E7%AE%97%E6%B3%95/"><span class="nav-text">算法</span> </a><a class="nav-item" href="/oi/categories/%E6%AF%94%E8%B5%9B/"><span class="nav-text">比赛</span> </a><a class="nav-item" href="/oi/tags/"><span class="nav-text">标签</span> </a><a class="nav-item" href="/oi/categories/"><span class="nav-text">分类</span> </a><a class="nav-item" href="/oi/archives/"><span class="nav-text">归档</span> </a><a class="nav-item" href="/oi/atom.xml"><span class="nav-text">订阅</span> </a><a class="nav-item" href="/oi/../about/"><span class="nav-text">关于</span></a></nav></div><aside id="aside" class="aside"><div id="aside-mask" class="aside-mask"></div><div id="aside-inner" class="aside-inner"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"><i class="icon-search-stroke"></i></button><input type="hidden" name="sitesearch" value="https://blog.lolifamily.js.org/oi"></form><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem"><span class="toc-number">1.</span> <span class="toc-text">Problem</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Description"><span class="toc-number">1.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Input"><span class="toc-number">1.2.</span> <span class="toc-text">Input</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Output"><span class="toc-number">1.3.</span> <span class="toc-text">Output</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sample-Input"><span class="toc-number">1.4.</span> <span class="toc-text">Sample Input</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sample-Output"><span class="toc-number">1.5.</span> <span class="toc-text">Sample Output</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%95%E4%B8%80-%E8%A1%8C%E5%88%97%E5%BC%8F"><span class="toc-number">2.</span> <span class="toc-text">法一: 行列式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#FH-%E5%AE%9A%E7%90%86"><span class="toc-number">2.1.</span> <span class="toc-text">FH 定理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%95%E4%BA%8C%EF%BC%9ADP"><span class="toc-number">3.</span> <span class="toc-text">法二：DP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E9%98%B6%E5%B7%AE%E5%88%86"><span class="toc-number">3.1.</span> <span class="toc-text">多阶差分</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%8C%E5%88%97%E5%BC%8F%E8%A7%A3%E6%B3%95%EF%BC%9A"><span class="toc-number">4.</span> <span class="toc-text">行列式解法：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DP%E8%A7%A3%E6%B3%95%EF%BC%9A"><span class="toc-number">5.</span> <span class="toc-text">DP解法：</span></a></li></ol></div></aside></header><div id="content" class="content"><div id="wrapper" class="wrapper" style="max-width:1000px"><article class="article" itemscope itemprop="blogPost"><header class="article-header"><h1 itemprop="name">[FJOI2007] 轮状病毒</h1><div class="article-meta clearfix"><a class="article-date" href="https://blog.lolifamily.js.org/oi/post/solution-code2422/index.html"><i class="icon-calendar vm"></i> <time class="vm" datetime="2018-08-12T14:52:06.000Z" itemprop="datePublished">2018-08-12</time></a><div class="article-tag-list"><i class="icon-tag vm"></i> <a class="article-tag-link" href="/oi/tags/DP/" rel="tag">DP</a>, <a class="article-tag-link" href="/oi/tags/%E5%B7%AE%E5%88%86/" rel="tag">差分</a>, <a class="article-tag-link" href="/oi/tags/%E7%9F%A9%E9%98%B5%E6%A0%91/" rel="tag">矩阵树</a></div></div></header><section class="article-body markdown-body"><p>由于内容过长、公式较多，暂时将内容隐藏，请公式恐惧症们做好心理准备。</p><span id="more"></span><h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><p>轮状病毒有很多变种，所有轮状病毒的变种都是从一个轮状基产生的。一个 $N$ 轮状基由圆环上 $N$ 个不同的基原子<br>和圆心处一个核原子构成的，$2$ 个原子之间的边表示这 $2$ 个原子之间的信息通道。如下图所示</p><img src="/oi/post/solution-code2422/1.png" title="1.png"><p>$N$ 轮状病毒的产生规律是在一个 $N$ 轮状基中删去若干条边，使得各原子之间有唯一的信息通道，例如共有 $16$ 个不<br>同的 $3$ 轮状病毒，如下图所示：</p><img src="/oi/post/solution-code2422/2.png" title="2.png"><p>现给定 $N (N\le 100)$，编程计算有多少个不同的 $N$ 轮状病毒</p><h3 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h3><p>第一行有 $1$ 个正整数 $N$</p><h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>计算出的不同的 $N$ 轮状病毒数输出</p><h3 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3</span><br></pre></td></tr></table></figure><h3 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">16</span><br></pre></td></tr></table></figure><h2 id="法一-行列式"><a href="#法一-行列式" class="headerlink" title="法一: 行列式"></a>法一: 行列式</h2><p>转载自 <a target="_blank" rel="noopener" href="http://vfleaking.blog.163.com/blog/static/17480763420119685112649/">vfleaking</a>，<a href="/oi/post/solution-code2422/bakup.png" title="题解备份">题解备份</a><br>对于新手还是建议去看看基尔霍夫矩阵，这一篇 <a target="_blank" rel="noopener" href="https://wenku.baidu.com/view/0c086741be1e650e52ea990e.html">论文</a> 挺不错的<br>用基尔霍夫矩阵使用高斯消元解行列式，时间复杂度 $O(n^3)$ 似乎可以 AC。<br>首先行列式有很多性质，第 $a$ 行 $\times k$ 加到第 $b$ 行上去，行列式的值不变。<br>三角行列式的值等于对角线元素之积。<br>第 $a$ 行与第 $b$ 行互换，行列式的值取反。<br>常数 $\times$ 行列式，可以把常数乘到某一行里去。<br>如果你行列式不是很熟，建议先搜搜行列式～不然下面会看晕～</p><p>其实如果你仔细观察矩阵，可以发现它是这样的：（消去了病毒中央）</p>$\begin{vmatrix} 3	&-1	&0	&0	&\cdots	&0	&0	&0	&-1\\ -1	&3	&-1	&0	&\cdots	&0	&0	&0	&0\\ 0	&-1	&3	&-1	&\cdots	&0	&0	&0	&0\\ 0	&0	&-1	&3	&\cdots	&0	&0	&0	&0\\ 0	&0	&0	&-1	&\cdots	&0	&0	&0	&0\\ \vdots	&\vdots	&\vdots	&\vdots	&\ddots	&\vdots	&\vdots	&\vdots	&\vdots\\ 0	&0	&0	&0	&\cdots	&3	&-1	&0	&0\\ 0	&0	&0	&0	&\cdots	&-1	&3	&-1	&0\\ 0	&0	&0	&0	&\cdots	&0	&-1	&3	&-1\\ -1	&0	&0	&0	&\cdots	&0	&0 &-1	&3 \end{vmatrix}$<p>那么我们现在对行列式进行变换，我们把第 $1$ 行与第 $2$ 行交换，再把第 $2$ 行与第 $3$ 行交换……，再把第 $n-1$ 行与第 $n$ 行变换，得到新的行列式：</p>$\begin{vmatrix} -1	&3	&-1	&0	&\cdots	&0	&0	&0	&0\\ 0	&-1	&3	&-1	&\cdots	&0	&0	&0	&0\\ 0	&0	&-1	&3	&\cdots	&0	&0	&0	&0\\ 0	&0	&0	&-1	&\cdots	&0	&0	&0	&0\\ \vdots	&\vdots	&\vdots	&\vdots	&\ddots	&\vdots	&\vdots	&\vdots	&\vdots\\ 0	&0	&0	&0	&\cdots	&3	&-1	&0	&0\\ 0	&0	&0	&0	&\cdots	&-1	&3	&-1	&0\\ 0	&0	&0	&0	&\cdots	&0	&-1	&3	&-1\\ -1	&0	&0	&0	&\cdots	&0	&0 &-1	&3\\ 3	&-1	&0	&0	&\cdots	&0	&0	&0	&-1 \end{vmatrix}$<p>这个行列式跟一开始的那个行列式的值不一定相等。<br>因为我们是通过 $n-1$ 次交换行的操作得到的，<br>为了说话方便我们称一开始的行列式为 $A$，上面刚写的行列式为 $B$<br>那么由行列式性质得：$A&#x3D;(-1)^{n-1}\cdot B$<br>现在就可以正大光明地处理 $B$ 了～</p><p>利用行列式性质，来手算这个行列式。之所以刚才有那么一步，就是为了方便手算。<br>因为观察 $B$ 矩阵，发现就只剩下左下角的 $-1$、$3$、$-1$ 三个倒霉了。</p>$\begin{matrix} \text{倒数第二行：} &-1	&0	&0	&0	&\cdots	&0	&0 &-1	&3\\ \text{用第一行的：} &-1	&3	&-1	&0	&\cdots	&0	&0	&0	&0\\ \text{乘以}-1\text{ 来消：}	&0	&-3	&1	&0	&\cdots	&0	&0 &-1	&3\\ \text{再用第二行：} &0	&-1	&3	&-1	&\cdots	&0	&0	&0	&0\\ \text{乘以}-3\text{ 来消：}	&0	&0	&-8	&3	&\cdots	&0	&0 &-1	&3 \end{matrix}$<p>这样就有了初步感觉了～</p><p>现在把这个过程一般化：</p>$\begin{matrix} \text{第 }k\text{ 个和第 }k+1\text{ 个：}	&0	&0	&\cdots	&F(k)	&G(k)	&0	&0	&\cdots	&-1	&3\\ \text{总能找到上面的某一行} &0	&0	&\cdots	&-1\quad	&3~~~	&-1	&0	&\cdots	&0	&0\\ \text{乘以 }F(k)\text{ 来消：} &0	&0	&\cdots	&0	&F(k+1)	&G(k+1)	&0	&\cdots	&-1	&3\\ \end{matrix}$<p>于是得到：</p>$\begin{cases} F(k+1)=G(k)+3F(k)\\ G(k+1)=-F(k) \end{cases}$<p>整合一下：$F(k+1)&#x3D;3F(k)-F(k-1)$<br>从初始的行和消了一次之后的行中取得边界条件：$F(1)&#x3D;-1,F(2)&#x3D;-3$<br>最终一定会变为下面这种情况：</p>$\begin{matrix} \text{倒数第二行：} &0	&0	&0	&0	&\cdots	&F(n-3)	&G(n-3)	&-1	&3\\ \text{用倒数第四行：} &0	&0	&0	&0	&\cdots	&-1	&3	&-1	&0\\ \text{乘以 }F(n - 3)\text{ 来消：}	&0	&0	&0	&0	&\cdots	&0	&F(n-2)	&G(n-2)-1	&3\\ \text{用倒数第三行：} &0	&0	&0	&0	&\cdots	&0	&-1	&3	&-1\\ \text{乘以 }F(n - 2)\text{ 来消：}	&0	&0	&0	&0	&\cdots	&0	&0	&F(n-1)-1	&G(n-1)+3 \end{matrix}$<p>好现在搞定了倒数第二行，来看看成果：$(f&#x3D;F(n-1)-1,g&#x3D;G(n-1)+3)$</p>$\begin{vmatrix} -1	&3	&-1	&0	&\cdots	&0	&0	&0	&0\\ 0	&-1	&3	&-1	&\cdots	&0	&0	&0	&0\\ 0	&0	&-1	&3	&\cdots	&0	&0	&0	&0\\ 0	&0	&0	&-1	&\cdots	&0	&0	&0	&0\\ \vdots	&\vdots	&\vdots	&\vdots	&\ddots	&\vdots	&\vdots	&\vdots	&\vdots\\ 0	&0	&0	&0	&\cdots	&3	&-1	&0	&0\\ 0	&0	&0	&0	&\cdots	&-1	&3	&-1	&0\\ 0	&0	&0	&0	&\cdots	&0	&-1	&3	&-1\\ 0	&0	&0	&0	&\cdots	&0	&0 &f	&g\\ 3	&-1	&0	&0	&\cdots	&0	&0	&0	&-1 \end{vmatrix}$<p>好，现在来搞倒数第一行。<br>和倒数第二行的方法是类似的。<br>再设函数 $H(k)$ 和 $I(k)$，意义与 $F(k)$、$G(k)$ 类似,得：</p>$\begin{cases} H(k+1)=I(k)+3H(k)\\ I(k+1)=-H(k) \end{cases}$<p>其实跟 $F$、$G$的递推式是一样的我会乱说？$H(k+1)&#x3D;3H(k)-H(k-1)$<br>边界条件是：$H(1)&#x3D;3,H(2)&#x3D;8$<br>最后使劲搞一搞，倒数第一行就成了：</p>$\begin{matrix} 0	&0	&0	&0	&0	&\cdots	&0	&0	&H(n - 1)	&I(n - 1)-1 \end{matrix}$<p>再来看成果：$(h&#x3D;H(n-1),i&#x3D;I(n-1)-1)$</p>$\begin{vmatrix} -1	&3	&-1	&0	&\cdots	&0	&0	&0	&0\\ 0	&-1	&3	&-1	&\cdots	&0	&0	&0	&0\\ 0	&0	&-1	&3	&\cdots	&0	&0	&0	&0\\ 0	&0	&0	&-1	&\cdots	&0	&0	&0	&0\\ \vdots	&\vdots	&\vdots	&\vdots	&\ddots	&\vdots	&\vdots	&\vdots	&\vdots\\ 0	&0	&0	&0	&\cdots	&3	&-1	&0	&0\\ 0	&0	&0	&0	&\cdots	&-1	&3	&-1	&0\\ 0	&0	&0	&0	&\cdots	&0	&-1	&3	&-1\\ 0	&0	&0	&0	&\cdots	&0	&0 &f	&g\\ 0	&0	&0	&0	&\cdots	&0	&0	&h	&i \end{vmatrix}$<p>用倒数第二行来消倒数第一行，得：</p>$\begin{matrix} 0	&0	&0	&0	&\cdots	&0	&0	&0	&i-g\cdot \frac hf ) \end{matrix}$<p>现在这个行列式已经是三角行列式了，它的值就是对角线元素之积。<br>于是：$B &#x3D;(-1)\times (-1)\times (-1)\times \cdots\times f(i-g\cdot \frac hf )$<br>一共有 $n-2$ 个 $-1$<br>如前文所述：$A&#x3D;(-1)^{n-1}B$<br>又因为：$B&#x3D;(-1)^{n-2}(f\cdot i-g\cdot h)$<br>于是有：$A&#x3D;(-1)^{2n-3}(f\cdot i-g\cdot h)&#x3D;-f\cdot i+g\cdot h$</p><p>带入 $f$、$g$、$h$、$i$ 的值得：<br>$A&#x3D;-(F(n-1)-1)(I(n-1)-1)+(G(n-1)+3)H(n-1)$<br>带入 $H$、$I$ 的值：<br>$A&#x3D;-(F(n-1)-1)(-H(n-2)-1)+(-F(n-2)+3)H(n-1)$<br>然后再展开……回忆下 $F$、$H$ 的递推式</p>$\begin{align*} A&=F(n-1)H(n-2)+F(n-1)-H(n-2)-1-F(n-2)H(n-1)+3H(n-1)\\ &=H(n)+F(n-1)+F(n-1)H(n-2)-F(n-2)H(n-1)-1\\ &=H(n)+F(n-1)+\begin{vmatrix}F(n-1) &H(n-1)\\F(n-2) &H(n-2)\end{vmatrix}-1 \end{align*}$<p>发现不能化简了？<br>没关系！在行列式上动动手脚吧！</p><h3 id="FH-定理"><a href="#FH-定理" class="headerlink" title="FH 定理"></a>FH 定理</h3><p>对于任意大于 $2$ 的 $k$ 有：</p>$\begin{vmatrix} F(k-1) &H(k-1)\\ F(k-2) &H(k-2) \end{vmatrix}=\begin{vmatrix} F(2) &H(2)\\ F(1) &H(1) \end{vmatrix}$<p><strong>证明</strong>：<br>对于行列式：$\begin{vmatrix} F(k-1) &H(k-1)\\ F(k-2) &H(k - 2) \end{vmatrix}$<br>把行列式最下面的行取反，则行列式的值取反： $-\begin{vmatrix} F(k-1) &H(k-1)\\ -F(k-2) &-H(k-2) \end{vmatrix}$<br>把行列式的上面的行乘以 $3$ 加到下面去： $-\begin{vmatrix} F(k-1) &H(k-1)\\ 3F(k-1)-F(k-2) &3H(k-1)-H(k-2) \end{vmatrix}$<br>特意构造的递推式出现了： $-\begin{vmatrix} F(k-1) &H(k-1)\\ F(k) &H(k) \end{vmatrix}$<br>有点眉目了~ 把第一行与第二行调换位置，行列式的值取反： $\begin{vmatrix} F(k) &H(k)\\ F(k-1) &H(k-1) \end{vmatrix}$<br>一目了然，这是 <code>k++</code> 后的行列式的样子。（ <strong>pascal同学早日转C++</strong> ）<br>那么立即推出： $\begin{vmatrix} F(k-1) &H(k-1)\\ F(k-2) &H(k-2) \end{vmatrix}=\begin{vmatrix} F(2) &H(2)\\ F(1) &H(1) \end{vmatrix}$<br>FH 定理得证。</p><p>利用 FH 定理，把 $F(1)&#x3D;-1,F(2)&#x3D;-3,H(1)&#x3D;3,H(2)&#x3D;8$带入： $\begin{vmatrix} F(n-1) &H(n-1)\\ F(n-2) &H(n-2) \end{vmatrix}=-1$</p><p>于是就爽了嘛！</p>$\begin{align*} \therefore A&=H(n)+F(n-1)+(-1)-1\\ &=H(n)+F(n-1)-2 \end{align*}$<p>进一步我们发现……<br>设 $R(n)&#x3D;H(n)+F(n-1)-2$<br>那么立即有：</p>$\begin{align*} R(n)&=3H(n-1)-H(n-2)+3F(n-2)-F(n-3)-2\\ &= 3(R(n-1)+2)-(R(n-2)+2)-2\\ &= 3R(n-1)-R(n-2)+2 \end{align*}$<p>所以，轮状病毒的方案数满足递推式 $F(n)&#x3D;3F(n-1)-F(n-2)+2$ ，其中 $F(1)&#x3D;1,F(2)&#x3D;5$<br>然后随手写一个高精度就可以过了～</p><h2 id="法二：DP"><a href="#法二：DP" class="headerlink" title="法二：DP"></a>法二：DP</h2><p>转载自 <a target="_blank" rel="noopener" href="https://www.luogu.org/blog/boshi/solution-p2144">boshi</a><br>如果用 $f[x]$ 表示加入了 $x$ 个周围的点后的方案数，我们首先想到的递推式是：$f[i]&#x3D;\sum_{j&#x3D;1}^i f[i-j]\cdot j$<br>解释：最后加入的 $j$ 个点每个都可能与中心点连边，将所有方案数累加即可。<br>但是，第一个点永远不会与第 $n$ 个点连边，因此方案数统计并不准确。<br>我们再设：$g[i]&#x3D;\sum_{j&#x3D;2}^i f[i-j]\cdot j\cdot (j-1)$<br>解释：如果有 $j$ 个周围的点连成一条，且跨越了 $1$ 和 $n$，我们将所有这样的情况累加到答案中去。如果这样的点有 $j$ 个，剩下的点肯定不与这 $j$ 个点相连，所以连边方案数就是 $f[i-j]$，这 $j$ 个点有 $(j-1)$ 种选法(跨越 $1$ 和 $n$ )，与中心点连边的方案数是 $j$ ，根据乘法原理，答案要累加 $f[i-j]\cdot j\cdot (j-1)$ 。<br>这样的 <code>f[n]+g[n]</code> 就是我们要求的轮状病毒的数量。</p><p>下面我们思考如何快速求出 $f$ 和 $g$。</p><h3 id="多阶差分"><a href="#多阶差分" class="headerlink" title="多阶差分"></a>多阶差分</h3><p>首先分析 $f[i]$。如果我们可以求出所有 $f[i-j]\cdot j$ 的前缀和，这个问题就变得非常方便了。问题是对于不同的 $i$，这个前缀和中每一项都会发生变化。<br>那如果我们知道了变化的量是多少呢？于是我们就对前缀和进行差分。</p>$\begin{align*} \Delta f[i]&=\sum_{j=1}^i f[i-j]\cdot j - \sum_{j=1}^{i-1} f[i-1-j]\cdot j\\ &=\sum_{j=0}^i f[i-j]\cdot j - \sum_{j=0}^{i-1} f[i-1-j]\cdot j\qquad (f[i]\cdot 0=f[i-1]\cdot 0=0)\\ &=\sum_{j=0}^i f[j]\cdot (i-j) - \sum_{j=0}^{i-1} f[j]\cdot (i-1-j)\qquad (\text{交换枚举顺序})\\ &=\sum_{j=0}^i f[i]\\ g[i]&=\sum_{j=2}^i f[i-j]\cdot j \cdot (j-1)\\ &=\sum_{j=0}^i f[i-j]\cdot j \cdot (j-1)\qquad(f[i-1]\cdot 1\cdot 0=0)\\ \Delta g[i]&=\sum_{j=0}^i f[i-j]\cdot j \cdot (j-1)-\sum_{j=0}^{i-1} f[i-j-1]\cdot (j-1) \cdot (j-2)\\ &=\sum_{j=0}^i f[j]\cdot (i-j)\cdot (i-j+1)-\sum_{j=0}^{i-1} f[j]\cdot (i-j)\cdot (i-j-1)\\ &=\sum_{j=0}^i f[j]\cdot (i-j)\cdot 2\qquad(i-i=0)\\ \Delta^2 g[i]&= \sum_{j=0}^i f[j]\cdot (i-j)\cdot 2-\sum_{j=0}^{i-1} f[j]\cdot (i-j-1)\cdot 2\\ &=\sum_{j=0}^i 2f[j]\qquad(i-i=0)\\ \therefore \Delta^3 &=2f[i] \end{align*}$<p>我们维护 $f[i]$ 的前缀和，以及 $f[i-j]\cdot j$ 的前缀和，每次将 $f[i]$ 累加进 $f[i]$ 的前缀和，将 $f[i]$ 的前缀和累加进 $f[i-j]\cdot j$ 的前缀和，$g[i]$ 同理</p><!--more--><h2 id="行列式解法："><a href="#行列式解法：" class="headerlink" title="行列式解法："></a>行列式解法：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> digit 100000000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">bigint</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">mutable</span> <span class="type">int</span> a[<span class="number">205</span>];</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="title">bigint</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">memset</span>(a,<span class="number">0</span>,<span class="built_in">sizeof</span>(a));</span><br><span class="line">		a[<span class="number">0</span>]=<span class="number">1</span>;a[<span class="number">1</span>]=<span class="number">0</span>;<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="title">bigint</span><span class="params">(<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">memset</span>(a,<span class="number">0</span>,<span class="built_in">sizeof</span>(a));</span><br><span class="line">		a[<span class="number">0</span>]=<span class="number">1</span>;a[<span class="number">1</span>]=b;<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">inline</span> <span class="type">int</span>&amp; <span class="keyword">operator</span>[](<span class="type">size_t</span> pos)<span class="type">const</span>&#123;<span class="keyword">return</span> a[pos];&#125;</span><br><span class="line">	<span class="keyword">inline</span> bigint <span class="keyword">operator</span>+(<span class="type">int</span> b)<span class="type">const</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">int</span> i;bigint c=*<span class="keyword">this</span>;</span><br><span class="line">		c[<span class="number">1</span>]+=b;</span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;=c[<span class="number">0</span>];++i)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(c[i]&gt;=digit)</span><br><span class="line">			&#123;</span><br><span class="line">				++c[i+<span class="number">1</span>];c[i]-=digit;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(c[c[<span class="number">0</span>]+<span class="number">1</span>])++c[<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">return</span> c;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">inline</span> bigint <span class="keyword">operator</span>-(<span class="type">const</span> bigint&amp; b)<span class="type">const</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">int</span> i;bigint c;c[<span class="number">0</span>]=a[<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;=c[<span class="number">0</span>];++i)c[i]=a[i]-b[i];</span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;=c[<span class="number">0</span>];++i)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(c[i]&lt;<span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				c[i]+=digit;--c[i+<span class="number">1</span>];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span>(!c[c[<span class="number">0</span>]]&amp;&amp;c[<span class="number">0</span>]&gt;<span class="number">1</span>)--c[<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">return</span> c;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">inline</span> bigint <span class="keyword">operator</span>*(<span class="type">int</span> b)<span class="type">const</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">int</span> i;bigint c;c[<span class="number">0</span>]=a[<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;=c[<span class="number">0</span>];++i)c[i]=a[i]*b;</span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;=c[<span class="number">0</span>]||c[i];++i)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(c[i]&gt;=digit)</span><br><span class="line">			&#123;</span><br><span class="line">				c[i+<span class="number">1</span>]+=c[i]/digit;c[i]%=digit;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		c[<span class="number">0</span>]=i<span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">return</span> c;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">friend</span> ostream&amp; <span class="keyword">operator</span>&lt;&lt;(ostream&amp; os,<span class="type">const</span> bigint&amp; a)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,a[a[<span class="number">0</span>]]);</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=a[<span class="number">0</span>]<span class="number">-1</span>;i&gt;=<span class="number">1</span>;--i)<span class="built_in">printf</span>(<span class="string">&quot;%08d&quot;</span>,a[i]);</span><br><span class="line">		<span class="keyword">return</span> os;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;f[<span class="number">3005</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> i,n;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">	f[<span class="number">1</span>]=<span class="number">1</span>;f[<span class="number">2</span>]=<span class="number">5</span>;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">3</span>;i&lt;=n;++i)f[i]=f[i<span class="number">-1</span>]*<span class="number">3</span>-f[i<span class="number">-2</span>]+<span class="number">2</span>;</span><br><span class="line">	cout&lt;&lt;f[n]&lt;&lt;endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="DP解法："><a href="#DP解法：" class="headerlink" title="DP解法："></a>DP解法：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> digit 1000000000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">bigint</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">mutable</span> <span class="type">int</span> a[<span class="number">205</span>];</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="title">bigint</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">memset</span>(a,<span class="number">0</span>,<span class="built_in">sizeof</span>(a));</span><br><span class="line">		a[<span class="number">0</span>]=<span class="number">1</span>;a[<span class="number">1</span>]=<span class="number">0</span>;<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="title">bigint</span><span class="params">(<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">memset</span>(a,<span class="number">0</span>,<span class="built_in">sizeof</span>(a));</span><br><span class="line">		a[<span class="number">0</span>]=<span class="number">1</span>;a[<span class="number">1</span>]=b;<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">inline</span> <span class="type">int</span>&amp; <span class="keyword">operator</span>[](<span class="type">size_t</span> pos)<span class="type">const</span>&#123;<span class="keyword">return</span> a[pos];&#125;</span><br><span class="line">	<span class="keyword">inline</span> bigint&amp; <span class="keyword">operator</span>+=(<span class="type">const</span> bigint&amp; b)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">int</span> i;a[<span class="number">0</span>]=<span class="built_in">max</span>(a[<span class="number">0</span>],b[<span class="number">0</span>]);</span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;=a[<span class="number">0</span>];++i)a[i]+=b[i];</span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;=a[<span class="number">0</span>];++i)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(a[i]&gt;=digit)</span><br><span class="line">			&#123;</span><br><span class="line">				++a[i+<span class="number">1</span>];a[i]-=digit;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(a[a[<span class="number">0</span>]+<span class="number">1</span>])++a[<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">friend</span> ostream&amp; <span class="keyword">operator</span>&lt;&lt;(ostream&amp; os,<span class="type">const</span> bigint&amp; a)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,a[a[<span class="number">0</span>]]);</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=a[<span class="number">0</span>]<span class="number">-1</span>;i&gt;=<span class="number">1</span>;--i)<span class="built_in">printf</span>(<span class="string">&quot;%09d&quot;</span>,a[i]);</span><br><span class="line">		<span class="keyword">return</span> os;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;F=<span class="number">1</span>,F1=<span class="number">1</span>,F2=<span class="number">1</span>,G=<span class="number">0</span>,G1=<span class="number">0</span>,G2=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> i,n;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(i)G2+=F,G2+=F;</span><br><span class="line">		<span class="keyword">if</span>(i&lt;n)G1+=G2,G+=G1;</span><br><span class="line">		F=F1;F2+=F;F1+=F2;</span><br><span class="line">	&#125;</span><br><span class="line">	cout&lt;&lt;(F+=G)&lt;&lt;endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>完结撒花！★,°:.☆(￣▽￣)&#x2F;$:.°★</p></section></article><a id="pagenext" href="/oi/post/solution-code4705/" class="article-next" title="[BZOJ3771]Triple"><i class="icon-arrow-right"></i></a> <a id="pageprev" href="/oi/post/solution-code2260/" class="article-prev" title="独木桥"><i class="icon-arrow-left"></i></a><div class="comments"><div id="comments"></div><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><script>new Gitalk({clientID:"f286404926d55f96d134",clientSecret:"149b70f078f14951dfd25f1ea7049e678e0e2b4a",repo:"discussion",owner:"loliblogs",admin:["lolifamily"],id:"9e6be2c631458e817de5bc03033eb8ac",distractionFreeMode:!0,title:"[FJOI2007] 轮状病毒",body:"https://blog.lolifamily.js.org/oi/post/solution-code2422/",labels:["DP","矩阵树","差分"]}).render("comments")</script></div></div></div><footer class="footer">Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, Theme by <a href="https://github.com/sanonz/hexo-theme-concise" target="_blank">Concise</a></footer></main><script>window.MathJax={tex:{inlineMath:[["$","$"],["$$$","$$$"]],displayMath:[["$$","$$"],["$$$$$$","$$$$$$"]],processEscapes:!0,autoload:{color:[],colorV2:["color"]},packages:{"[+]":["noerrors"]}},options:{skipHtmlTags:["script","noscript","style","textarea","pre","code"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"},loader:{load:["[tex]/noerrors"]}}</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script><script src="https://unpkg.com/jquery@1.9.1/jquery.min.js"></script><script>$(function(){var n={nav:$("#nav"),aside:$("#aside"),asideInner:$("#aside-inner"),navInner:$("#nav-inner")},e=!1;function i(){"none"!==n.navInner.css("display")&&n.navInner.css("display","")}n.asideInner.on("webkitAnimationEnd mozAnimationEnd oAnimationEnd oanimationend animationend",function(){n.aside.hasClass("mobile-open")?n.aside.removeClass("mobile-open"):n.aside.removeClass("mobile-close panel-show"),e=!1}),$("#open-panel, #aside-mask").on("click",function(){e||(n.aside.hasClass("panel-show")?n.aside.addClass("mobile-close"):n.aside.addClass("mobile-open panel-show"))}),$("#open-menus").on("click",function(){n.navInner.slideToggle("normal",i)}),window.innerWidth<=960&&setTimeout(function(){n.navInner.slideUp("normal",i)},3e3),$(window).on("resize",function(){960<$(this).width()&&n.navInner.css("display","")})})</script><script src="/oi/js/scrollspy.min.js"></script><script>$(document.body).scrollspy({target:"#aside-inner a[href*=\\%]"}),$(window).on("resize",function(){var e=$("#header").width(),t=$("#wrapper").width(),t=($(this).width()-e-t)/2/2,i=$("#pageprev"),r=$("#pagenext"),d=(i.width()+r.width())/2;d<t?(t=t-d/2,d={position:"fixed",top:"50%",marginTop:-(i.width()+r.width())/4},i.css($.extend({left:e+t},d)),r.css($.extend({right:t},d))):(i.removeAttr("style"),r.removeAttr("style"))}).trigger("resize")</script></body></html>